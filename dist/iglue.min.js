"use strict";!function(window){window.iglue_env=window.iglue_env||{},window.iglue_env.base_url=""}(this);var iglue_env={};window&&Object.assign(iglue_env,window.iglue_env);var iglue_mod=angular.module("iglue",["http-auth-interceptor","ngResource"]).constant("__env",iglue_env);iglue_mod.factory("AppGlue",["$resource","__env",function($resource,__env){var user_manager_base_url=__env.base_url+"user_manager/";return $resource(__env.base_url+"application",{},{get:{method:"GET",params:{},isArray:!1},version:{method:"GET",isArray:!1,url:__env.base_url+"application/version"},api:{method:"GET",isArray:!1,url:__env.base_url+"api"},sessions:{method:"GET",isArray:!0,url:user_manager_base_url+"sessions/:series"},settings:{method:"GET",isArray:!1,url:user_manager_base_url+"applicationSettings"}})}]),iglue_mod.factory("PaymentGlue",["$resource","__env",function($resource,__env){return $resource(__env.base_url+"payment",{},{client_token:{method:"POST",params:{},isArray:!1,url:__env.base_url+"payment/client_token"},checkout:{method:"POST",params:{},isArray:!1,url:__env.base_url+"payment/checkout"},subscribe:{method:"POST",isArray:!1,url:__env.base_url+"payment/subscribe"},mysubscriptions:{method:"GET",isArray:!1,url:__env.base_url+"payment/my_subscriptions"},mytransactions:{method:"GET",isArray:!1,url:__env.base_url+"payment/my_transactions"},subscriptions:{method:"GET",isArray:!1,url:__env.base_url+"payment/subscriptions"},cancel_subscription:{method:"GET",params:{subscriptionId:"@subscriptionId"},isArray:!1,url:__env.base_url+"payment/cancel_subscription"}})}]),iglue_mod.factory("SubscriptionGlue",["$resource","__env",function($resource,__env){return $resource(__env.base_url+"subscription/plan/:id",{},{update:{method:"POST",isArray:!1,url:__env.base_url+"subscription/plan/update"},query:{method:"GET",transformResponse:function(data,headers){return JSON.parse(data)}},get:{method:"GET"},getByPlanId:{method:"POST",params:{planId:"@planId"},isArray:!1,url:__env.base_url+"subscription/plan/getByPlanId"}})}]),iglue_mod.factory("UserGlue",["$resource","__env",function($resource,__env){var user_manager_base_url=__env.base_url+"user_manager/";return $resource(user_manager_base_url+"applicationUser",{},{account:{method:"GET",isArray:!1,url:user_manager_base_url+"account"},register:{method:"GET",isArray:!1,url:user_manager_base_url+"register"},resetPassword:{method:"GET",isArray:!1,url:user_manager_base_url+"resetPassword"},changePassword:{method:"GET",isArray:!1,url:user_manager_base_url+"changePassword"},activate:{method:"GET",isArray:!1,url:user_manager_base_url+"activate"}})}]),iglue_mod.factory("Session",function(){return this.create=function(landingPage,login,firstName,lastName,email,userRoles,imgSrc){this.landingPage=landingPage,this.login=login,this.firstName=firstName,this.lastName=lastName,this.email=email,this.userRoles=userRoles,this.imgSrc=imgSrc},this.invalidate=function(){this.landingPage=null,this.login=null,this.firstName=null,this.lastName=null,this.email=null,this.userRoles=null,this.imgSrc=null},this}),iglue_mod.factory("$auth",["$iglue","$http","$rootScope","authService","Session","__env",function($iglue,$http,$rootScope,authService,Session,__env){return{login:function(login,password,remember_me){remember_me||(remember_me=!0);var data="j_username="+login+"&j_password="+password+"&_spring_security_remember_me="+remember_me+"&submit=Login";$http.post(__env.base_url+"app/authentication",data,{headers:{"Content-Type":"application/x-www-form-urlencoded"},ignoreAuthModule:"ignoreAuthModule",withCredentials:!0}).success(function(data,status,headers,config){$iglue.user().account(function(data){Session.create(data.landingPage,data.login,data.firstName,data.lastName,data.email,data.roles,data.imgSrc),$rootScope.account=Session,$rootScope.authenticated=!0,authService.loginConfirmed(data)})}).error(function(data,status,headers,config){$rootScope.authenticationError=!0,$rootScope.authenticated=!1,$rootScope.account=null,Session.invalidate()})},logout:function(){$http.get(__env.base_url+"app/logout").success(function(data,status,headers,config){$rootScope.authenticationError=!1,$rootScope.authenticated=!1,$rootScope.account=null,Session.invalidate(),authService.loginCancelled(),$rootScope.$broadcast("event:auth-logout")})}}}]),iglue_mod.factory("$iglue",["AppGlue","UserGlue",function(AppGlue,UserGlue){return{app:function(){return AppGlue},user:function(){return UserGlue}}}]),iglue_mod.factory("$conduit",["$resource","$window","$q","__env",function($resource,$window,$q,__env){var conduit={sessionStorage:function(name){return{get:function(){var storage=angular.fromJson(sessionStorage[name]);return storage||(storage={}),storage},save:function(data){sessionStorage[name]=angular.toJson(data)},remove:function(){sessionStorage[name]=null}}},localStorage:function(name){return{get:function(){var storage=angular.fromJson($window.localStorage.getItem(name));return storage||(storage={}),storage},save:function(data){$window.localStorage.setItem(name,angular.toJson(data))},remove:function(){$window.localStorage.removeItem(name)}}},createMongoFlow:function(endpoint,database){var context={template:"mongo_crud.json",databaseName:database,flowName:endpoint,collectionName:endpoint},deferred=$q.defer();return $resource(__env.base_url+"conduit/flows/template",{},{}).save(context,function(){deferred.resolve(conduit.collection(endpoint))}),deferred.promise},collection:function(flowname,context){var endpoint=__env.base_url+"conduit/rest/"+flowname;return context&&(endpoint+="/action/"+context),{get:function(params){params||(params={});var deferred=$q.defer();return $resource(endpoint,{},{}).get(params,function(data){deferred.resolve(data)}),deferred.promise},getById:function(id){var deferred=$q.defer();return $resource(endpoint+"/"+id+"/?",{},{}).get({id:this.id},function(data){deferred.resolve(data)}),deferred.promise},post:function(params){var deferred=$q.defer();return $resource(endpoint,{},{}).save(params,function(data){deferred.resolve(data)}),deferred.promise},save:function(params){return this.post(params)},remove:function(id){var deferred=$q.defer();return $resource(endpoint+"/"+id,{},{}).remove({id:this.id},function(data){deferred.resolve(data)}),deferred.promise}}}};return conduit}]),angular.module("http-auth-interceptor",["http-auth-interceptor-buffer"]).factory("authService",["$rootScope","httpBuffer",function($rootScope,httpBuffer){return{loginConfirmed:function(data,configUpdater){$rootScope.$broadcast("event:auth-loginConfirmed",data)},loginCancelled:function(data,reason){httpBuffer.rejectAll(reason),$rootScope.$broadcast("event:auth-loginCancelled",data)}}}]).config(["$httpProvider",function($httpProvider){$httpProvider.defaults.withCredentials=!0,$httpProvider.interceptors.push(["$rootScope","$q","httpBuffer",function($rootScope,$q,httpBuffer){return{responseError:function(rejection){var config=rejection.config||{};if(!config.ignoreAuthModule)switch(rejection.status){case 401:var deferred=$q.defer();return httpBuffer.append(config,deferred),$rootScope.$broadcast("event:auth-loginRequired",rejection),deferred.promise;case 403:$rootScope.$broadcast("event:auth-notAuthorized",rejection)}return $q.reject(rejection)}}}])}]),angular.module("http-auth-interceptor-buffer",[]).factory("httpBuffer",["$injector",function($injector){var $http,buffer=[];function retryHttpRequest(config,deferred){($http=$http||$injector.get("$http"))(config).then(function(response){deferred.resolve(response)},function(response){deferred.reject(response)})}return{append:function(config,deferred){buffer.push({config:config,deferred:deferred})},rejectAll:function(reason){if(reason)for(var i=0;i<buffer.length;++i)buffer[i].deferred.reject(reason);buffer=[]},retryAll:function(updater){for(var i=0;i<buffer.length;++i)retryHttpRequest(updater(buffer[i].config),buffer[i].deferred);buffer=[]}}}]),function(){function QueryBuilder(){this.page=1,this.rows=20,this.sord="ASC",this.sidx="_id",this.criteria={},this.projection={},this.totalpages=0,this.totalrecords=0,this.orMode=!1,this.orCriteria={}}QueryBuilder.prototype.setRows=function(rows){return this.rows=rows,this},QueryBuilder.prototype.or=function(){return this.orMode=!0,this},QueryBuilder.prototype.and=function(){return this.orMode=!1,this},QueryBuilder.prototype.setPage=function(page){var totalPages=Number(this.totalpages),pageNumber=Number(page);return totalPages<pageNumber&&(pageNumber=totalPages),pageNumber<1&&(pageNumber=1),this.page=Number(pageNumber),this},QueryBuilder.prototype.nextPage=function(){return this.setPage(Number(this.page)+1)},QueryBuilder.prototype.previousPage=function(){return this.setPage(Number(this.page)-1)},QueryBuilder.prototype.addColumn=function(field){return this.projection[field]=1,this},QueryBuilder.prototype.build=function(){return this.orCriteria.$or&&this.criteria.$and.push(this.orCriteria),{page:this.page,rows:this.rows,sord:this.sord,sidx:this.sidx,orMode:this.orMode,filterByFields:JSON.stringify(this.criteria),projection:JSON.stringify(this.projection)}},QueryBuilder.prototype.toggleSort=function(){return"ASC"===this.sord?this.sord="DESC":this.sord="ASC",this},QueryBuilder.prototype.ascending=function(){return this.sord="ASC",this},QueryBuilder.prototype.descending=function(){return this.sord="DESC",this},QueryBuilder.prototype.qry=function(){return this.criteria={},this.orCriteria={},this.projection={},this.orMode=!1,this},QueryBuilder.prototype.rowS=function(rows){return this.rows=rows,this},QueryBuilder.prototype.sidX=function(id){return this.sidx=id,this},QueryBuilder.prototype.add=function(searchField,searchOper,searchString){if(!searchString||""===searchString)return this;var condition={},criteria={};"icn"===searchOper?condition={$regex:searchString,$options:"i"}:condition["$"+searchOper]=searchString,criteria[searchField]=condition;var and=this.criteria.$and;if(and||(and=[]),this.orMode){var or=this.orCriteria.$or;or||(or=[]),or.push(criteria),this.orCriteria.$or=or}else and.push(criteria);return this.criteria.$and=and,this},QueryBuilder.prototype.cn=function(field,value){return this.add(field,"cn",value)},QueryBuilder.prototype.icn=function(field,value){return this.add(field,"icn",value)},QueryBuilder.prototype.bw=function(field,value){return this.add(field,"bw",value)},QueryBuilder.prototype.ew=function(field,value){return this.add(field,"ew",value)},QueryBuilder.prototype.eq=function(field,value){return this.add(field,"eq",value)},QueryBuilder.prototype.ne=function(field,value){return this.add(field,"ne",value)},QueryBuilder.prototype.nc=function(field,value){return this.add(field,"nc",value)},QueryBuilder.prototype.en=function(field,value){return this.add(field,"en",value)},QueryBuilder.prototype.bn=function(field,value){return this.add(field,"bn",value)},QueryBuilder.prototype.gt=function(field,value){return this.add(field,"gt",value)},QueryBuilder.prototype.ge=function(field,value){return this.add(field,"ge",value)},QueryBuilder.prototype.lt=function(field,value){return this.add(field,"lt",value)},QueryBuilder.prototype.le=function(field,value){return this.add(field,"le",value)},QueryBuilder.prototype.in=function(field,value){return this.add(field,"in",value)},QueryBuilder.prototype.nn=function(field,value){return this.add(field,"nn",value)},QueryBuilder.prototype.new=function(){return new QueryBuilder},window.queryBuilder=new QueryBuilder,window.queryBuilder}();